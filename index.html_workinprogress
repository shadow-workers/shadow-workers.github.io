<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link type="text/css" href="index.css" media="all" rel="stylesheet">
    <title>Shadow Workers</title>
    <meta property="og:title" content="Shadow Workers">
    <meta property="og:locale" content="en_US">
    <meta name="description" content="Shadow Workers">
    <meta property="og:description" content="Shadow Workers">
    <link rel="canonical" href="https://shadow-workers.github.io/">
    <meta property="og:url" content="https://shadow-workers.github.io/">
    <meta property="og:site_name" content="Shadow Workers">
  </head>

  <body class="home">
    <section id="top-part" class="top-part">
      <img src="logo.png" alt="Shadow Workers" class="logo">
    </section>

    <section class="shadow">
    <h1><span class="shadow-text">Shadow</span> Workers</h1>
    </section>

    <section class="shadow">
      <h3>
        <span class="shadow-text">Shadow</span> Workers is free and an open source C2 and proxy designed for penetration testers to help in the exploitation of XSS and malicious Service Workers (SW).<br/>
        A successful exploitation allows you to browse on the targeted application as the victim(s), as long as the SW (agent) is active. A victim does not have to have a browser tab open in the application for the agent to be active.<br/>
        The following conditions need to be met in order to be able to achieve SW registration on victims' browsers (Chrome only at the moment):<br/>
        <ul class="conditions-list wrapper active">
          <li>You have the ability to upload a JavaScript file on the application</li>
          <li>The JavaScript file is served from the same domain of the application</li>
          <li>The JavaScript file is served with Content-Type application/javascript</li>
          <li>An XSS vulnerability exists on the application</li>
          <li class="hidden"></li>
        </ul>
        Currently the tool supports the following features:<br/>
        <ul class="conditions-list wrapper active">
          <li><a href="https://developers.google.com/web/updates/2015/12/background-sync" target="_blank">Background Sync</a></li>
          <li><a href="https://developers.google.com/web/ilt/pwa/introduction-to-push-notifications" target="_blank">Push notifications</a></li>
          <li>DOM poisoning via <a href="https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker" target="_blank">fetch handler</a></li>
          <li class="hidden"></li>
        </ul>
        To setup the C2 and proxy:
      </h3>

      <ul class="shadow-list wrapper active">
        
        <li>
          <h4>Register Domain</h4>
          <p>
            Register a domain and point it to an Internet facing host (C2).
          </p>
        </li>
        
        <li>
          <h4>Install dependencies on C2 host</h4>
          <p>
            Python 3<br/>
            Nginx
          </p>
        </li>
          
        <li>
          <h4>Clone the repository</h4>
          <p>On the C2 host, go the folder where you want to store your project, clone the project and install the dependencies:</p>
          <div class="terminal">
            <div class="header">C2 host</div>
            <div class="shell">
              <p>
                <span class="prompt">$</span> git clone https://github.com/<em>shadow-workers</em>/<em>shadow-workers</em>.git<br/>
                <span class="prompt">$</span> cd <em>shadow-workers</em></br/>
                <span class="prompt">$</span> pip install -r requirements.txt
              </p>
            </div>
          </div>
        </li>
        
        <li>
          <h4>Configure Nginx</h4>
          <p>On the C2 host, generate SSL/TLS certificate using <a href="https://letsencrypt.org/" target="_blank">letsencrypt</a> (or anything you prefer) and add the following to Nginx configuration (ensure you change the domain and path to key and certificate):</p>
          <div class="terminal">
            <div class="header">/etc/nginx/nginx.conf</div>
            <div class="shell">
              <p>
                server {<br/>
                  listen       443 ssl;<br/>
                  server_name  DOMAIN_REGISTERED;<br/><br/>

                  ssl_certificate      PATH_TO_CERTIFICATE;<br/>
                  ssl_certificate_key  PATH_TO_PRIVATE_KEY;<br/><br/>

                  ssl_session_cache    shared:SSL:1m;<br/>
                  ssl_session_timeout  5m;<br/><br/>

                  ssl_ciphers  HIGH:!aNULL:!MD5;<br/>
                  ssl_prefer_server_ciphers  on;<br/>
                  location / {<br/>
                   proxy_set_header Host $host;<br/>
                   proxy_set_header X-Forwarded-Proto https;<br/>
                   proxy_set_header X-Forwarded-For $remote_addr;<br/>
                   proxy_pass http://localhost:5000;<br/>
                  }<br/>
              }
              </p>
            </div>
          </div>
        </li>
        
        <li>
          <h4>Start C2</h4>
          <div class="terminal">
            <div class="header">C2 host</div>
            <div class="shell">
              <p>
                <span class="prompt">$</span> sudo /etc/init.d/nginx start<br/>
                <span class="prompt">$</span> ./start.sh<br/>
                Credentials for dashboard<br/>
                USERNAME: workers<br/>
                PASSOWRD: PASSWORD
              </p>
            </div>
          </div>
          <p>Take note of the PASSWORD from the output</p>
        </li>

        <li>
          <h4>Map C2 8888 TCP port to localhost</h4>
          <p>On your local machine:</p>
          <div class="terminal">
            <div class="header">localhost</div>
            <div class="shell">
              <p>
                <span class="prompt">$</span> ssh -L 8888:localhost:8888 C2_HOST
              </p>
            </div>
          </div>
        </li>
        
        <li>
          <h4>Browse to C2 dashboard</h4>
          <p>
            In your browser, choose to use the following socks proxy in the browser preferences: type: socks, address: 127.0.0.0, port: 8888.<br/>
            Open a browser to the address: https://DOMAIN_REGISTERED/dashboard/<br/>
            To authenticate, provide "workers" as username and the password from the output generated from the start.sh script.
          </p>
        </li>
        
        <li>
          <h4>Generate SW</h4>
          <p>
            Generate and copy the malicious Service Worker (SW) to be uploaded on the target application.<br/>
            TODO - screenshot</br/>
            Upload it against the vulnerable application.
          </p>
        </li>
        
        <li>
          <h4>Trigger the XSS to register the SW</h4>
          <p>
            Send the malicious XSS to the application and trick the users to browse to it.<br/>
            The XSS payload can be generated on the C2 host at: https://C2_HOST/modules/xss . Note that you can specify a "path" parameter to point to the exact location of the uploaded SW on the compromised application (ex: ?path=/uploads/1234). If you prefer, when exploiting the XSS, you can just load the JS from that location.<br/>
            TODO - screenshot
          </p>
        </li>
        
        <li>
          <h4>Dashboard</h4>
          <p>
            When the victims visit the malicious XSS and the SWs are registered on their browsers, the agents (SW) will become available on the dashboard.<br/>
            TODO - screenshot
          </p>
        </li>
        
        <li>
          <h4>Proxy through agent</h4>
          <p>
            While a victim's agent (SW) is active, you can proxy through that agent and browse on the compromised application as the victim.<br/>
            TODO - screenshot<br/>
            Note that as soon as the agent is dormant, you will not be able to proxy any longer.
          </p>
        </li>
        
        <li>
          <h4>Execute modules</h4>
          <p>
            You can run post exploitation modules against the victim's agent (SW). For example, you can execute a localhost port scan.<br/>
            TODO - screenshot<br/>
            Note that you can also write your own post exploitation scripts. Please refer to the official documentation for more information.
          </p>
        </li>
        
        <li>
          <h4>Push notifications</h4>
          <p>
            If the victim allowed the SW to received notifications, you can activate the agent on demand by sending a push notification.<br/>
            On the dashboard. the option to deliver a push notification is only visible if the actual push registration has been received on the C2.<br/>
            TODO - screenshot<br/>
            Note that a visual notification might appear on the victim's device, so use this caution.
          </p>
        </li>
        
        <li>
          <h4>DOM poisoning</h4>
          <p>
            The SW is capable of intercepting and poisoning requests made from within the scope. For more information around SW scope, please refer to <a href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope" target="_blank">https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope</a>.<br/>
            For example, if the SW scope is "/uploads", the SW will be able to poison requests made from "/uploads". If the application has functionality that renders HTML pages under that path, the victims' agents will wake up everytime they browse to such pages under the scope. If no functionality exists under the scope, you can attempt to trick the victims to visit a non-existing page under that path; for example, by phishing. The web server will respond with the default 404 html page, and the SW will still be able to perform DOM poisoning on that and wake up the agent.<br/>
            Note that while the victim has a window open on the poisoned page, you can send arbitrary JS to it.<br/>
            TODO - screenshot
          </p>
        </li>
        
        <li>
          <h4>Contribute</h4>
          <p>Clone to the project and submit pull requests</p>
          <div class="terminal">
            <div class="header">GitHub Project</div>
            <div class="shell">
              <p>
                <a href="https://github.com/shadow-workers/shadow-workers">https://github.com/shadow-workers/shadow-workers</a><br/>
                Fork the project<br/>
                Create your feature branch (git checkout -b my-new-feature)<br/>
                Commit your changes (git commit -am 'Added some feature')<br/>
                Push to the branch (git push origin my-new-feature)<br/>
                Create new Pull Request
              </p>
            </div>
          </div>
        </li>
        
        <li class="hidden"></li>
        
      </ul>

    </section>

  </body>
</html>